<!DOCTYPE html>
<meta charset="utf-8">
<head>
  <title>Zoom + Pan within limits</title>
  <link rel="stylesheet" type="text/css" href="./includes/css/main.css">
  <script src="https://bl.ocks.org/mhsmith/raw/5732011/d3-zoom-pan-extent.js"></script>
</head>
<body>
  <script type="text/javascript">

  // margins
  var margin = {top: 20, right: 20, bottom: 40, left: 50},
      width = window.innerWidth - margin.left - margin.right,  // 900 - 40 - 20 = 840
      height = window.innerHeight - margin.top - margin.bottom; // 500 - 20 - 30 = 450

  var x = d3.scale.linear().range([0, width]);

  var y = d3.scale.linear().range([height, 0]);


  d3.csv('includes/data/fast5_data.csv', function(error, data) {
      data.forEach(function(d) {
        d.time = +d.time;
        d.signal = +d.signal;
      });

      x.domain([ d3.min(data, function(d){ return d.time; }) , d3.max(data,function(d){ return d.time; }) ]);
      y.domain([ d3.min(data, function(d){ return d.signal; } )  , d3.max(data, function(d){ return d.signal; }) ]);

      var xAxis = d3.svg.axis()
          .scale(x)
          .orient("bottom")
          .tickSize(-height);
      var yAxis = d3.svg.axis()
          .scale(y)
          .orient("left")
          .ticks(5)
          .tickSize(-width);

          var zoom = d3.behavior.zoom()
              .x(x)
              .xExtent([0,d3.max(data,function(d){ return d.time; })]) // this means that the x-axis can go at most from 0 to 500.
              .scaleExtent([1, 1000]) // this tells the scale how deep should it go (for example [1,100] only goes until nearest unit)
              .on("zoom", zoomed);

          var svg = d3.select("body").append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom)
            .append("g")
              .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
              .call(zoom);

          svg.append("rect")
              .attr("width", width)
              .attr("height", height);
          svg.append("g")
              .attr("class", "x axis")
              .attr("transform", "translate(0," + height+ ")")
              .call(xAxis);
          svg.append("g")
              .attr("class", "y axis")
              .call(yAxis);

          // Add axis labels
          svg.append("text")
             .attr("transform","translate(" + width/2 + ", " + (height+10) + ")")
             .attr("dy","1em")
             .style("text-anchor","middle")
             .style("font-size","20px")
             .text("Time, s");

          svg.append("text")
             .attr("transform", "rotate(-90) translate(" + 0 + "," + (margin.left-20) + ")")
             .attr("y", 0 - margin.left)
             .attr("x",0 - (height / 2))
             .style("font-size","20px")
             .style("text-anchor", "middle")
             .text("Signal Value, pA");


          function zoomed() {
            svg.select(".x.axis").call(xAxis);
            svg.select(".y.axis").call(yAxis);
            svg.selectAll(".dot")
               .attr("cx", function(d){ return x(d.time); })
               .attr("cy", function(d){ return y(d.signal); });

            svg.selectAll(".squiggle")
               .attr("d", lineFunction(data));
          }


          svg.selectAll("circle")
             .data(data)
             .enter()
             .append("circle")
              .attr("cx", function(d){ return x(d.time);})
              .attr("cy", function(d){ return y(d.signal);})
              .attr("class","dot")
              .attr("r",5);


          var lineFunction = d3.svg.line()
            .x(function(d) { return x(d.time); })
            .y(function(d) { return y(d.signal); })
            .interpolate('linear');

          var lineGraph = svg.append("path")
            .attr("d", lineFunction(data))
            .attr("class","squiggle")
            .attr("stroke", "blue")
            .attr("stroke-width", 2)
            .attr("fill", "none");



  });

  </script>
</body>
